<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeroVault - D&D Character Manager</title>
    <link rel="stylesheet" href="/client/css/style.css">
    <link rel="stylesheet" href="/client/css/create-spell.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bahiana&family=Cinzel:wght@400;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="content">
        <div class="navbar main-header">
            <div class="nav-content">
                <a href="/client/index.html">
                    <div class="nav-left">
                        <i class="fas logo fa-dragon "></i>
                        <span class="brand">HeroVault</span>
                    </div>
                </a>
                <div class="nav-center create-navbar">
                    <div class="cteate-title">Creating Spell</div>
                </div>
                <div class="nav-right profile">
                    <div class="profileimg"></div>
                    <div class="profilename">Adventure Master</div>
                </div>
            </div>
        </div>

        <div class="main">

            <div class="section-spell-info">
                <div class="section-title">Spell Information</div>

                <div class="spell-name">
                    <div>Spell Name</div>
                    <input type="text" placeholder="Enter spell name...">
                </div>

                <div class="spell-level text-input">
                    <div>Level</div>
                    <input type="text" placeholder="0-9">
                </div>

                <div class="spell-school text-input">
                    <div>School</div>
                    <input type="text" placeholder="e.g., Evocation, Abjuration...">
                </div>

                <div class="spell-classes text-input">
                    <div>Classes Can Use</div>
                    <input type="text" placeholder="e.g., Wizard, Sorcerer...">
                </div>
            </div>

            <div class="section-spell-stats">
                <div class="section-title">Spell Details</div>

                <div class="spell-cast-time text-input">
                    <div>Casting Time</div>
                    <input type="text" placeholder="e.g., 1 action, 1 bonus action...">
                </div>

                <div class="spell-range text-input">
                    <div>Range</div>
                    <input type="text" placeholder="e.g., Self, 60 feet...">
                </div>

                <div class="spell-radius text-input">
                    <div>Area/Radius</div>
                    <input type="text" placeholder="e.g., 20-foot radius...">
                </div>

                <div class="spell-duration text-input">
                    <div>Duration</div>
                    <input type="text" placeholder="e.g., Instantaneous, 1 minute...">
                </div>

                <div class="spell-components multiselect-container">
                    <div>Components</div>
                    <div class="selected-tags"></div>
                    <input type="text" placeholder="Type and press Enter..." class="multiselect-input">
                </div>
            </div>

            <div class="section-spell-description">
                <div class="section-title">Spell Description</div>
                
                <div class="spell-description description">
                    <div>Description</div>
                    <textarea name="spell-description" id="spell-description" placeholder="Enter spell description..."></textarea>
                </div>

                <div class="spell-higher-levels description">
                    <div>At Higher Levels</div>
                    <textarea name="spell-higher-levels" id="spell-higher-levels" placeholder="Describe what happens when cast at higher levels..."></textarea>
                </div>
            </div>

            <div class="input-img">
                <div class="input-img-content">
                    <div>Spell Image</div>
                    <input type="file" accept="image/*">
                </div>
                <button class="button-create">Create Spell</button>
            </div>

        </div>

<script src="/client/js/particles.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tinymce@6/tinymce.min.js"></script>
<script>
// Initialize TinyMCE for all description textareas
tinymce.init({
  selector: 'textarea[id="spell-description"], textarea[id="spell-higher-levels"]',
  menubar: false,
  plugins: 'lists link image table code',
  toolbar: 'undo redo | bold italic underline | bullist ',
  height: 200,
  resize: 'vertical',
  content_style: `
    body { 
      font-family: 'Roboto', sans-serif; 
      color: #ffffff; 
      background: transparent; 
      font-size: 14px; 
      line-height: 1.5; 
    }
  `,
  skin: 'oxide-dark',
  content_css: 'dark'
});

// Multi-select functionality
document.addEventListener('DOMContentLoaded', function() {
  initializeMultiSelect();
});

function initializeMultiSelect() {
  const multiselectInputs = document.querySelectorAll('.multiselect-input');
  
  multiselectInputs.forEach(input => {
    const container = input.closest('.multiselect-container');
    const tagsContainer = container.querySelector('.selected-tags');
    let selectedValues = [];
    
    // Handle input events
    input.addEventListener('input', function(e) {
      const value = e.target.value.trim();
      if (value && !selectedValues.includes(value)) {
        addTag(value, tagsContainer, selectedValues, input);
      }
      e.target.value = '';
    });
    
    // Handle keydown events
    input.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ',') {
        e.preventDefault();
        const value = e.target.value.trim();
        if (value && !selectedValues.includes(value)) {
          addTag(value, tagsContainer, selectedValues, input);
          e.target.value = '';
        }
      } else if (e.key === 'Backspace' && e.target.value === '' && selectedValues.length > 0) {
        removeLastTag(tagsContainer, selectedValues, input);
      }
    });
    
    // Handle datalist selection
    input.addEventListener('change', function(e) {
      const value = e.target.value.trim();
      if (value && !selectedValues.includes(value)) {
        addTag(value, tagsContainer, selectedValues, input);
        e.target.value = '';
      }
    });
  });
}

function addTag(value, tagsContainer, selectedValues, input) {
  if (value && !selectedValues.includes(value)) {
    selectedValues.push(value);
    
    const tag = document.createElement('div');
    tag.className = 'tag';
    tag.innerHTML = `
      <span>${value}</span>
      <button type="button" class="tag-remove" onclick="removeTag(this, '${value}', this.closest('.multiselect-container').querySelector('.selected-tags'), this.closest('.multiselect-container').querySelector('.multiselect-input'))">Ã—</button>
    `;
    
    tagsContainer.appendChild(tag);
    input.focus();
  }
}

function removeTag(button, value, tagsContainer, input) {
  const tag = button.closest('.tag');
  const container = button.closest('.multiselect-container');
  const selectedValues = Array.from(tagsContainer.querySelectorAll('.tag span')).map(span => span.textContent);
  
  // Remove from selectedValues array
  const index = selectedValues.indexOf(value);
  if (index > -1) {
    selectedValues.splice(index, 1);
  }
  
  // Remove tag element
  tag.remove();
  input.focus();
}

function removeLastTag(tagsContainer, selectedValues, input) {
  const lastTag = tagsContainer.querySelector('.tag:last-child');
  if (lastTag) {
    const value = lastTag.querySelector('span').textContent;
    removeTag(lastTag.querySelector('.tag-remove'), value, tagsContainer, input);
  }
}
</script>
</body>
</html>