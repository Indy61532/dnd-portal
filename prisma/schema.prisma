// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String       @id @default(cuid())
  email         String       @unique
  passwordHash  String       @map("password_hash")
  displayName   String?      @map("display_name")
  bio           String?
  avatar        String?
  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")
  
  characters    Character[]
  campaigns     Campaign[]   @relation("CampaignOwner")
  campaignMembers CampaignMember[]
  collections   Collection[]
  refreshTokens RefreshToken[]
  
  @@map("users")
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String   @map("user_id")
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("refresh_tokens")
}

model Character {
  id          String   @id @default(cuid())
  name        String
  level       Int      @default(1)
  race        String?
  class       String?
  subclass    String?
  background  String?
  image       String?
  
  // Stats
  strength    Int      @default(10)
  dexterity   Int      @default(10)
  constitution Int     @default(10)
  intelligence Int     @default(10)
  wisdom      Int      @default(10)
  charisma    Int      @default(10)
  
  // Additional data as JSON
  additionalData Json? @map("additional_data")
  
  userId      String   @map("user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("characters")
}

model Item {
  id          String   @id @default(cuid())
  name        String
  type        String
  description String?  @db.Text
  weight      Float?
  cost        String?
  rarity      String?
  isMagic     Boolean  @default(false) @map("is_magic")
  
  // Armor specific
  armorAC     Int?     @map("armor_ac")
  
  // Weapon specific
  weaponType  String?  @map("weapon_type")
  diceTrove   String?  @map("dice_trove")
  dieType     String?  @map("die_type")
  range       String?
  
  image       String?
  tags        String[]
  userId      String   @map("user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  @@map("items")
}

model Monster {
  id          String   @id @default(cuid())
  name        String
  type        String?
  cr          String?  // Challenge Rating
  ac          Int?     // Armor Class
  hp          Int?     // Hit Points
  description String?  @db.Text
  image       String?
  tags        String[]
  userId      String   @map("user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  @@map("monsters")
}

model Spell {
  id          String   @id @default(cuid())
  name        String
  level       Int      @default(0)
  type        String?
  range       String?
  description String?  @db.Text
  image       String?
  tags        String[]
  userId      String   @map("user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  @@map("spells")
}

model Class {
  id          String   @id @default(cuid())
  name        String
  description String?  @db.Text
  image       String?
  tags        String[]
  userId      String   @map("user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  subclasses  Subclass[]
  
  @@map("classes")
}

model Race {
  id          String   @id @default(cuid())
  name        String
  description String?  @db.Text
  image       String?
  tags        String[]
  userId      String   @map("user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  @@map("races")
}

model Background {
  id          String   @id @default(cuid())
  name        String
  description String?  @db.Text
  image       String?
  tags        String[]
  userId      String   @map("user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  @@map("backgrounds")
}

model Feat {
  id          String   @id @default(cuid())
  name        String
  tier        String?
  description String?  @db.Text
  image       String?
  tags        String[]
  userId      String   @map("user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  @@map("feats")
}

model Subclass {
  id          String   @id @default(cuid())
  name        String
  parentClassId String @map("parent_class_id")
  description String?  @db.Text
  image       String?
  tags        String[]
  userId      String   @map("user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  parentClass Class    @relation(fields: [parentClassId], references: [id], onDelete: Cascade)
  
  @@map("subclasses")
}

model Pet {
  id          String   @id @default(cuid())
  name        String
  description String?  @db.Text
  image       String?
  tags        String[]
  userId      String   @map("user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  @@map("pets")
}

model Faith {
  id          String   @id @default(cuid())
  name        String
  domain      String?
  alignment   String?
  description String?  @db.Text
  image       String?
  tags        String[]
  userId      String   @map("user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  @@map("faiths")
}

model Campaign {
  id          String   @id @default(cuid())
  name        String
  description String?  @db.Text
  image       String?
  ownerId     String   @map("owner_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  owner       User     @relation("CampaignOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  members     CampaignMember[]
  
  @@map("campaigns")
}

model CampaignMember {
  id         String   @id @default(cuid())
  campaignId String   @map("campaign_id")
  userId     String   @map("user_id")
  role       String   @default("player") // player, dm, etc.
  joinedAt   DateTime @default(now()) @map("joined_at")
  
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([campaignId, userId])
  @@map("campaign_members")
}

model Collection {
  id          String   @id @default(cuid())
  userId      String   @map("user_id")
  contentType String   @map("content_type") // item, monster, spell, class, race, background, feat, subclass, pet, faith
  contentId   String   @map("content_id")
  createdAt   DateTime @default(now()) @map("created_at")
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, contentType, contentId])
  @@map("collections")
}

